---
title: "Gentrification Prediction"
author: "Yuanhao Zhai & Jiewen Hu"
date: "May 10, 2024"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: "hide"
    code_download: true
---

## 1.1. Introduction

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## 2.1. Setup

```{r setup_13, cache=TRUE, message=FALSE}
library(tidyverse)
library(sf)
library(lubridate)
library(tigris)
library(tidycensus)
library(viridis)
library(riem)
library(gridExtra)
library(knitr)
library(kableExtra)
library(RSocrata)
library(ggplot2)
library(dplyr)

plotTheme <- theme(
  plot.title =element_text(size=12),
  plot.subtitle = element_text(size=8),
  plot.caption = element_text(size = 6),
  axis.text.x = element_text(size = 10, angle = 45, hjust = 1),
  axis.text.y = element_text(size = 10),
  axis.title.y = element_text(size = 10),
  # Set the entire chart region to blank
  panel.background=element_blank(),
  plot.background=element_blank(),
  #panel.border=element_rect(colour="#F0F0F0"),
  # Format the grid
  panel.grid.major=element_line(colour="#D0D0D0",size=.2),
  axis.ticks=element_blank())

mapTheme <- theme(plot.title =element_text(size=12),
                  plot.subtitle = element_text(size=8),
                  plot.caption = element_text(size = 6),
                  axis.line=element_blank(),
                  axis.text.x=element_blank(),
                  axis.text.y=element_blank(),
                  axis.ticks=element_blank(),
                  axis.title.x=element_blank(),
                  axis.title.y=element_blank(),
                  panel.background=element_blank(),
                  panel.border=element_blank(),
                  panel.grid.major=element_line(colour = 'transparent'),
                  panel.grid.minor=element_blank(),
                  legend.direction = "vertical", 
                  legend.position = "right",
                  plot.margin = margin(1, 1, 1, 1, 'cm'),
                  legend.key.height = unit(1, "cm"), legend.key.width = unit(0.2, "cm"))

palette5 <- c("#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c")
palette4 <- c("#D2FBD4","#92BCAB","#527D82","#123F5A")
palette2 <- c("#6baed6","#08519c")
```

```{r install_census_API_key, warning = FALSE, include=FALSE, eval = TRUE}
# Install Census API Key
tidycensus::census_api_key("e79f3706b6d61249968c6ce88794f6f556e5bf3d", overwrite = TRUE)
```

## 2.2. Import Census Info

```{r get_census, message=FALSE, warning=FALSE, cache=TRUE, results = 'hide'}
fullcount90 <- read.csv("D:/Upenn/006/CPLN5920/final/ltdb_std_all_fullcount/LTDB_Std_1990_fullcount.csv")
sample90 <- read.csv("D:/Upenn/006/CPLN5920/final/LTDB_Std_All_Sample/ltdb_std_all_sample/ltdb_std_1990_sample.csv")
data90 <- merge(fullcount90, sample90, by = "TRTID10")

fullcount00 <- read.csv("D:/Upenn/006/CPLN5920/final/ltdb_std_all_fullcount/LTDB_Std_2000_fullcount.csv")
sample00 <- read.csv("D:/Upenn/006/CPLN5920/final/LTDB_Std_All_Sample/ltdb_std_all_sample/ltdb_std_2000_sample.csv")
data00 <- merge(fullcount00, sample00, by = "TRTID10")
```

```{r}
glimpse(data00)
```

```{r ChicagoCensus90}
chicagoCensus90 <- data90 %>%
  filter(county.x == "Cook County" & state.x == "IL")%>%

  rename(Total_Pop = POP90,
         White_Pop = NHWHT90,
         Black_Pop = NHBLK90,
         Latino_Pop = HISP90,
         Elder_Pop = A75UP90,
         Children_Pop = A18UND90,
         College_Pop = COL90, #  College Education
         Owner_Occupied = OWN90, #  Owner Occupied
         Total_housing_units = HU90,
         Vacant_housing_units = VAC90,
         Median_House_Value = MHMVAL90,
         Median_Rent = MRENT90,
         Below_Poverty_Pop = DPOV90,
         Professional_Employeed = PROF90,
         Total_Employeed = EMPCLF90,
         Female_Households = FHH90,
         Total_Households = FAMILY90)%>%
  
  select(TRTID10, Total_Pop, White_Pop, Black_Pop, Latino_Pop, Elder_Pop, Children_Pop, College_Pop, Owner_Occupied, Median_House_Value, Median_Rent, Below_Poverty_Pop, Professional_Employeed, Total_Employeed, Female_Households, Total_Households, Total_housing_units, Vacant_housing_units)%>%
  
  mutate(
    Pt_White = White_Pop / Total_Pop * 100, 
    Pt_Black = Black_Pop / Total_Pop * 100, 
    Pt_Latino = Latino_Pop / Total_Pop * 100,  
    Pt_Elderly = Elder_Pop / Total_Pop * 100,  # % Elderly (Age 75+)
    Pt_Children = (Children_Pop / Total_Pop) * 100,  # % Children (Age <18)
    Pt_College = College_Pop / Total_Pop * 100,
    Pt_Owner_Occupied = Owner_Occupied / Total_housing_units * 100,  
    Median_House_Value_Adjusted = Median_House_Value,  # Median House Value, adjust for inflation
    Median_Rent_Adjusted = Median_Rent, # Median Rent Value, adjust for inflation
    Pt_Below_Poverty = Below_Poverty_Pop / Total_Pop * 100,
    #Pt_Manager = Professional_Employeed / Total_Employeed * 100, #
    Pt_Female_Households = Female_Households / Total_Households * 100,
    Pt_Vacant = Vacant_housing_units / Total_housing_units * 100
      #Percent_Private_School  
  )%>%
  select( -Total_Pop,-White_Pop, -Black_Pop, -Latino_Pop, -Elder_Pop, -Children_Pop, -College_Pop, -Owner_Occupied,-Below_Poverty_Pop,  -Female_Households, -Total_Households, -Total_housing_units, -Vacant_housing_units,-Median_House_Value, -Median_Rent) 

```

```{r}
glimpse(chicagoCensus90)
```

```{r ChicagoCensus00}
chicagoCensus00 <- data00 %>%
  filter(county.x == "Cook County" & state.x == "IL")%>%

  rename(Total_Pop = POP00,
         White_Pop = NHWHT00,
         Black_Pop = NHBLK00,
         Latino_Pop = HISP00,
         Elder_Pop = A75UP00,
         Children_Pop = A18UND00,
         College_Pop = COL00,
         Owner_Occupied = OWN00,
         Total_housing_units = HU00,
         Vacant_housing_units = VAC00,
         Median_House_Value = MHMVAL00,
         Median_Rent = MRENT00,
         Below_Poverty_Pop = DPOV00,
         Professional_Employeed = PROF00,
         Total_Employeed = EMPCLF00,
         Female_Households = FHH00,
         Total_Households = FAMILY00)%>%
  
  select(TRTID10, Total_Pop, White_Pop, Black_Pop, Latino_Pop, Elder_Pop, Children_Pop, College_Pop, Owner_Occupied, Median_House_Value, Median_Rent, Below_Poverty_Pop, Professional_Employeed, Total_Employeed, Female_Households, Total_Households, Total_housing_units, Vacant_housing_units)%>%
  
  mutate(
    Pt_White = White_Pop / Total_Pop * 100, 
    Pt_Black = Black_Pop / Total_Pop * 100, 
    Pt_Latino = Latino_Pop / Total_Pop * 100,  
    Pt_Elderly = Elder_Pop / Total_Pop * 100,  # % Elderly (Age 75+)
    Pt_Children = (Children_Pop / Total_Pop) * 100,  # % Children (Age <18)
    Pt_College = College_Pop / Total_Pop * 100,
    Pt_Owner_Occupied = Owner_Occupied / Total_housing_units * 100,  
    Median_House_Value_Adjusted = Median_House_Value,  # Median House Value, adjust for inflation
    Median_Rent_Adjusted = Median_Rent, # Median Rent Value, adjust for inflation
    Pt_Below_Poverty = Below_Poverty_Pop / Total_Pop * 100,
    #Pt_Manager = Professional_Employeed / Total_Employeed * 100, 
    Pt_Female_Households = Female_Households / Total_Households * 100,
    Pt_Vacant = Vacant_housing_units / Total_housing_units * 100
      #Percent_Private_School  
  )%>%
  select( -Total_Pop,-White_Pop, -Black_Pop, -Latino_Pop, -Elder_Pop, -Children_Pop, -College_Pop, -Owner_Occupied,-Below_Poverty_Pop,  -Female_Households, -Total_Households, -Total_housing_units, -Vacant_housing_units,-Median_House_Value, -Median_Rent) 

```

```{r}
glimpse(chicagoCensus00)
```

```{r}
# 载入2019年ACS 5-year survey的变量
vars <- load_variables(2010, "acs5", cache = TRUE)
View(vars)
```

```{r get_census10, message=FALSE, warning=FALSE, cache=TRUE, results = 'hide'}
chicagoCensus10 <- 
  get_acs(geography = "tract", 
          variables = c("B01003_001", "B02009_001", 
                        "B02001_002", "B03001_003",
                        "B06001_012", "B09001_001", 
                        "B06009_005","B07013_002",
                        "B25001_001", "B25004_001",
                        "B25077_001", "B25064_001",
                        "B17001_002", "B24011_001",
                        	"B11005_002","B11001_001"), #"B23006_027", "B23006_013", "B23006_006", "B23006_020",
          year = 2010, 
          state = "IL", 
          geometry = TRUE, 
          county=c("Cook"),
          output = "wide") %>%
  
  rename(Total_Pop = B01003_001E,
         White_Pop = B02001_002E,
         Black_Pop = B02009_001E,
         Latino_Pop = B03001_003E,
         Elder_Pop = B06001_012E, #  Elderly (Age 75+)
         Children_Pop = B09001_001E, #  Children (Age <18)
         College_Pop = B06009_005E ,
         Owner_Occupied = B07013_002E,
         Total_housing_units = B25001_001E,
         Vacant_housing_units = B25004_001E,
         Median_House_Value = B25077_001E,
         Median_Rent = B25064_001E,
         Below_Poverty_Pop = B17001_002E,
         
         #Professional_Employeed = B24011_001E,
         #Total_Employed_1 = B23006_027E,
         #Total_Employed_2 = B23006_013E,
         #Total_Employed_3 =  B23006_006E,
         #Total_Employed_4 = B23006_020E,
        
         Female_Households = B11005_002E,
         Total_Households = B11001_001E)%>%
  
  select(Total_Pop, White_Pop, Black_Pop, Latino_Pop, Elder_Pop, Children_Pop, College_Pop, Owner_Occupied, Median_House_Value, Median_Rent, Below_Poverty_Pop,   Female_Households, Total_Households, Total_housing_units, Vacant_housing_units,
         GEOID, geometry) %>% #Professional_Employeed,Total_Employed_1, Total_Employed_2, Total_Employed_3, Total_Employed_4
  
  
  
  mutate(Pt_White = White_Pop / Total_Pop * 100, 
    Pt_Black = Black_Pop / Total_Pop * 100, 
    Pt_Latino = Latino_Pop / Total_Pop * 100,  
    Pt_Elderly = Elder_Pop / Total_Pop * 100,  # % Elderly (Age 75+)
    Pt_Children = (Children_Pop / Total_Pop) * 100,  # % Children (Age <18)
    Pt_College = College_Pop / Total_Pop * 100,
    Pt_Owner_Occupied = Owner_Occupied / Total_housing_units * 100,  
    Median_House_Value_Adjusted = Median_House_Value,  # Median House Value, adjust for inflation
    Median_Rent_Adjusted = Median_Rent, # Median Rent Value, adjust for inflation
    Pt_Below_Poverty = Below_Poverty_Pop / Total_Pop * 100,
    #Pt_Manager = Professional_Employeed / (Total_Employed_1 + Total_Employed_2 + Total_Employed_3 + Total_Employed_4) * 100, #
    Pt_Female_Households = Female_Households / Total_Households * 100,
    Pt_Vacant = Vacant_housing_units / Total_housing_units * 100)%>%
  select( -Total_Pop,-White_Pop, -Black_Pop, -Latino_Pop, -Elder_Pop, -Children_Pop, -College_Pop, -Owner_Occupied,-Below_Poverty_Pop,  -Female_Households, -Total_Households, -Total_housing_units, -Vacant_housing_units,-Median_House_Value, -Median_Rent) #-Professional_Employeed, -Total_Employed_1, -Total_Employed_2, -Total_Employed_3, -Total_Employed_4,
```

```{r}
glimpse(chicagoCensus10)
```

```{r get_census20, message=FALSE, warning=FALSE, cache=TRUE, results = 'hide'}
chicagoCensus20 <- 
  get_acs(geography = "tract", 
          variables = c("B01003_001", "B02009_001", 
                        "B02001_002", "B03001_003",
                        "B06001_012", "B09001_001", 
                        "B06009_005","B07013_002",
                        "B25001_001", "B25004_001",
                        "B25077_001", "B25064_001",
                        "B17001_002", "B24011_001",
                        	"B11005_002","B11001_001"), #"B23006_027", "B23006_013", "B23006_006", "B23006_020",
          year = 2020, 
          state = "IL", 
          geometry = TRUE, 
          county=c("Cook"),
          output = "wide") %>%
  
  rename(Total_Pop = B01003_001E,
         White_Pop = B02001_002E,
         Black_Pop = B02009_001E,
         Latino_Pop = B03001_003E,
         Elder_Pop = B06001_012E, #  Elderly (Age 75+)
         Children_Pop = B09001_001E, #  Children (Age <18)
         College_Pop = B06009_005E ,
         Owner_Occupied = B07013_002E,
         Total_housing_units = B25001_001E,
         Vacant_housing_units = B25004_001E,
         Median_House_Value = B25077_001E,
         Median_Rent = B25064_001E,
         Below_Poverty_Pop = B17001_002E,
         
         #Professional_Employeed = B24011_001E,
         #Total_Employed_1 = B23006_027E,
         #Total_Employed_2 = B23006_013E,
         #Total_Employed_3 =  B23006_006E,
         #Total_Employed_4 = B23006_020E,
        
         Female_Households = B11005_002E,
         Total_Households = B11001_001E)%>%
  
  select(Total_Pop, White_Pop, Black_Pop, Latino_Pop, Elder_Pop, Children_Pop, College_Pop, Owner_Occupied, Median_House_Value, Median_Rent, Below_Poverty_Pop,   Female_Households, Total_Households, Total_housing_units, Vacant_housing_units,
         GEOID, geometry) %>% #Professional_Employeed,Total_Employed_1, Total_Employed_2, Total_Employed_3, Total_Employed_4
  
  
  
  mutate(Pt_White = White_Pop / Total_Pop * 100, 
    Pt_Black = Black_Pop / Total_Pop * 100, 
    Pt_Latino = Latino_Pop / Total_Pop * 100,  
    Pt_Elderly = Elder_Pop / Total_Pop * 100,  # % Elderly (Age 75+)
    Pt_Children = (Children_Pop / Total_Pop) * 100,  # % Children (Age <18)
    Pt_College = College_Pop / Total_Pop * 100,
    Pt_Owner_Occupied = Owner_Occupied / Total_housing_units * 100,  
    Median_House_Value_Adjusted = Median_House_Value,  # Median House Value, adjust for inflation
    Median_Rent_Adjusted = Median_Rent, # Median Rent Value, adjust for inflation
    Pt_Below_Poverty = Below_Poverty_Pop / Total_Pop * 100,
    #Pt_Manager = Professional_Employeed / (Total_Employed_1 + Total_Employed_2 + Total_Employed_3 + Total_Employed_4) * 100, #
    Pt_Female_Households = Female_Households / Total_Households * 100,
    Pt_Vacant = Vacant_housing_units / Total_housing_units * 100)%>%
  select( -Total_Pop,-White_Pop, -Black_Pop, -Latino_Pop, -Elder_Pop, -Children_Pop, -College_Pop, -Owner_Occupied,-Below_Poverty_Pop,  -Female_Households, -Total_Households, -Total_housing_units, -Vacant_housing_units,-Median_House_Value, -Median_Rent) #-Professional_Employeed, -Total_Employed_1, -Total_Employed_2, -Total_Employed_3, -Total_Employed_4,
```

```{r}
glimpse(chicagoCensus20)
```
```{r extract_geometries }
chicagoTracts <- 
  chicagoCensus10 %>%
  as.data.frame() %>%
  distinct(GEOID, .keep_all = TRUE) %>%
  select(GEOID, geometry) %>% 
  st_sf
```
















